---
title: "fvcom - nodes and elements"
author: "Bigelow Computational Ecology Lab"
date: "8/22/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```
## Accessing FVCOM data

```{r}
library("fvcom")
library(ncdf4)
uri_base <- "http://www.smast.umassd.edu:8080/thredds/dodsC/models/fvcom/NECOFS/Archive/NECOFS_GOM/2019/"
uri <- file.path(uri_base, "gom4_201901.nc")
x <- nc_open(uri)
```

## Elements

### Locating elements

Retrieve the locations of elements using `fvcom_elems()`

+ `xc[nele]` zonal x-coordinate

+ `yc[nele]` zonal y-coordinate

+ `lonc[nele]` zonal longitude

+ `latc[nele]` zonal latitude

### Relationships among elements and nodes

+ `nv[nele,three]` nodes surrounding element

Each node is

```
> head(ncvar_get(x, 'nv'))
     [,1] [,2] [,3]
[1,]   96    1   95       # <- three nodes enclose an element
[2,]   95    1    2
[3,]    3   95    2
[4,]   95    3   97
[5,]   97    3   98
[6,]    4   98    3
```

+ `nbe[nele,three]`  elements surrounding each element

Element neighbors are those that share edges.

```
> head(ncvar_get(x, 'nbe'))
     [,1] [,2] [,3]
[1,]    2  187    0       # <- an element can have at most 3 neighboring
[2,]    0    3    1       #    elements.  0 = no neighbor
[3,]    2    0    4
[4,]    5  188    3
[5,]    6  190    4
[6,]    5    0    7
```

+ `ntve[node]`` # elems surrounding each node

```
> ncdf4::ncvar_get(x, "ntve")
[1] 2 2 4 3 3 3

```

+ `nbve[node,maxelem]` elems surrounding each node

```
> head(ncvar_get(x, "nbve"))
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
[1,]    2    1    0    0    0    0    0    0    0
[2,]    3    2    0    0    0    0    0    0    0
[3,]    6    5    4    3    0    0    0    0    0
[4,]    8    7    6    0    0    0    0    0    0
[5,]   10    9    8    0    0    0    0    0    0
[6,]   12   11   10    0    0    0    0    0    0
```

### Variables at elements

"Vector values, such as velocity are defined at the element centroids."

+ `v [nele,siglay,time]` Northward Water Velocity

+ `u [nele,siglay,time]` Eastward Water Velocity

+ `ww [nele,siglay,time]` Upward Water Velocity

+ `ua[nele,time]` Vertically Averaged x-velocity

+ `va[nele,time``] Vertically Averaged y-velocity
